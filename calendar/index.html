<!DOCTYPE html>
<!-- xlsx.js (C) 2013-present  SheetJS http://sheetjs.com -->
<!-- vim: set ts=2: -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>HZR-Calendar</title>
<style>

#drop{
	border:2px dashed #bbb;
	-moz-border-radius:5px;
	-webkit-border-radius:5px;
	border-radius:5px;
	padding:25px;
	text-align:center;
	font:20pt bold,"Vollkorn";color:#bbb
}
#b64data{
	width:100%;
}
.fc-time{
	display: none;
}
a { text-decoration: none }
</style>
		<link href='./css/fullcalendar.min.css' rel='stylesheet' />
		<link href='./css/fullcalendar.print.min.css' rel='stylesheet' media='print' />
		<script src='./js/moment.min.js'></script>
		<script src='./js/jquery.min.js'></script>
		<script src='./js/fullcalendar.min.js'></script>
		<script src='./js/html2canvas.min.js'></script>
		<script src='./js/canvas2image.js'></script>
		<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

		<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
		<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

		<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
		<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script>
		ch_month = ["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];
		en_month = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
		en_month_kv = {"January":"Jan","February":"Feb","March":"Mar","April":"Apr","May":"May","June":"Jun","July":"Jul",
		"August":"Aug","September":"Sep","October":"Oct","November":"Nov","December":"Dec"};
		en_ch_month_kv={"January":"一月","February":"二月","March":"三月","April":"四月","May":"五月","June":"六月","July":"七月",
		"August":"八月","September":"九月","October":"十月","November":"十一月","December":"十二月"};
		en_week=["SUN","MON","TUE","WED","THU","FRI","SAT"];
			$(function(){
				$('#calendar').fullCalendar({
					header: {
						left: 'prev,next today',
						center: 'title',
						right: 'month,basicWeek,basicDay'
					},
					titleFormat:'YYYY-MMMM',
					buttonText:{
						'today':'今天',
						'month':'月',
						'week':'周',
						'day':'日'
					},
					// monthNames:en_month,
					// monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],
					//dayNames:['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
					dayNamesShort:en_week,
					firstDay:1,
					editable: true,
					timeFormat: 'H:mm',
					axisFormat: 'H:mm',
					navLinks: true, // can click day/week names to navigate views
					editable: true,
					eventLimit: false, // allow "more" link when too many events
					events: [
					]
				});
			});
$(".fc-scroller").css("height", "100%");
$(".fc-day-grid-container").css("height", "100%");
		</script>
		<style>

			body {
				margin: 40px 10px;
				padding: 0;
				font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
				font-size: 14px;
			}

			#calendar {
				max-width: 100%;
				margin: 0 auto;
				margin-left: 0px;
				padding-right: 10px;
				padding-left:10px;
				margin-bottom: 5em;
			}
			#c-title-panel{
				max-width: 45%
			}
			th.fc-mon,th.fc-tue,th.fc-wed,th.fc-thu,th.fc-fri{
				background-color: #7F7F7F;
				color: white;
			}
			th.fc-day-header{
				padding-top: 8px;
				padding-bottom: 8px;
			}
			th.fc-sat,th.fc-sun{
				color: white;
				background-color: #FF1E00;
			}
			#data-panel{
				display: flex;
				border: 1px solid red;
			}
			.fc-right {
				display: none;
			}
			.fc-toolbar .fc-left{
				float: right;
			}
			.fc-toolbar .fc-center{
				float: left;
				color: red;
				font-size: 18px;
			}
			#event-table{
				width: 55%;
				border-left: 2px solid red;
				/*background-color: red;*/
				/*padding: 10px;*/
			}
			.event-title{
				background-color: red;
				margin-top: -4px;
				border: 2px solid white;
				-webkit-box-shadow:0 0 15px red;
  			-moz-box-shadow:0 0 15px red;
  			box-shadow:0 0 15px red;
			}
			.fc-toolbar.fc-header-toolbar{
				margin-bottom: 0em;
			}
			#c-logo{
				max-width: 60%;
				height: auto;
			}
			#disc-desc{
				color: red;
				font-size: 1.8em;
				font-weight: bold;
				width: 100%;
				padding-right: 10px;
			}
			#circle-month{
				width: 100%;


				text-align: center;
				color: red;
				font-size: 3.5em;
				font-weight: bold;
			}
			.color-group{
				width: 25%
			}
			/*td.bm-title{
				width: 17%
			}*/
			.bm-color{
				padding:0px !important;
			}
			.bm-text{
				text-align: right;
			}
			.bm-color-val{
				min-height: 1.1em;
			}
			.bm-color-val-zy {
				background-color: #FEDD28;
			}
			.bm-color-val-qy{
				background-color: #FCCBA1;
			}
			.bm-color-val-pe{
				background-color: #CEDDAB;
			}
			.bm-color-val-xs{
				background-color: #C0B2D1
			}
			.event-title{
				color: white;
				text-align: center;
				margin-left: -5px;
				margin-right: -5px;
			}
			.event-year{
				font-size: 4em;
			}
			.event-desc{
				font-size: 1.8em
			}
			.event-month{
				font-size: 3em
			}
			.event-dist{
				font-size: 1.5em
			}
			.fc-other-month .fc-day-number{
				display: none;
			}
			.fc-content{
				text-align: center;
			}
			td.event-td{
				padding-right: 10px;
			}
			.fc-event{
				color: black;
			}
			.event-td-r{
				background-color: red;
				border: 1px solid red;
			}

		</style>
</head>
<body>
<!-- <pre> -->
(拖拽方式支持：IE10+ Chrome)<select name="format" onchange="setfmt()" display="none" style="display:none">
<option value="json" selected> json</option>
</select><br />
<div id="drop">Drop a spreadsheet file here to see sheet data</div>
<!-- <input type="file" name="xlfile" id="xlf" /> ... or click here to select a file -->

<!-- <textarea id="b64data">... or paste a base64-encoding here</textarea> -->
<!-- <input type="button" id="dotext" value="Click here to process the base64 text" onclick="b64it();"/><br /> -->
<!-- <b>Advanced Demo Options:</b> -->
<div hidden="hidden">
Use Web Workers: (when available) <input type="checkbox" name="useworker" checked>
Use Transferrables: (when available) <input type="checkbox" name="xferable" checked>
Use readAsBinaryString: (when available) <input type="checkbox" name="userabs" checked>
</div>
<!-- </pre> -->
 <!-- <pre id="out"></pre>
<div id="htmlout"></div> -->
<br />
<!-- uncomment the next line here and in xlsxworker.js for encoding support -->
		<div style="margin:20px">
			<input type="button" id="toImageBt" value="日历->图片">
			尺寸缩放：<input type="range" id="body-scale" min="1" value="100" max="1000" style="width:500px;display:initial" />
			<select id="body-select">
  			<option value ="100%">100%</option>
  			<option value ="120%">120%</option>
  			<option value="140%">140%</option>
  			<option value="160%">160%</option>
				<option value="180%">180%</option>
				<option value="200%">200%</option>
			</select>
			<a href="" id="downloadImage" style="display:none;">downloadImage</a>
		</div>
		<div id="data-container"  style="display:block; width:100%">
	<div id="data-panel" style="width:100%;margin:0 auto">
		<div id="c-title-panel">
			<section id="banner-sec" style="display:flex; padding:10px">
				<div id="c-logo">
					<img style="width:100%" src="img/c_logo.png">
				</div>
				<div id="disc-month" style="width:60%;display:inherit;float:right;margin-left:auto;margin-right:2m;padding:0.4em">
					<div id="disc-desc"><label id="dis-name" style="position:relative;bottom:-65%;float:right">- -</label></div>
					<div id="circle-month"><label id="top-month"></label></div>
				</div>
			</section>
			<div style="padding-left:5px;padding-right:5px;margin-right:1.5em">
			  <div class="col-xs-3 bm-color col-md-3"><div class="col-xs-7 col-md-7 bm-text bm-color">中央市场部&nbsp</div><div class="col-xs-5 bm-color bm-color-val bm-color-val-zy col-md-5"></div></div>
				<div class="col-xs-3 bm-color col-md-3"><div class="col-xs-7 col-md-7 bm-text bm-color">区域市场部&nbsp</div><div class="col-xs-5 bm-color bm-color-val bm-color-val-qy col-md-5"></div></div>
				<div class="col-xs-2 bm-color col-md-2"><div class="col-xs-4 col-md-4 bm-text bm-color">PE&nbsp</div><div class="col-xs-8 bm-color bm-color-val bm-color-val-pe col-md-8"></div></div>
				<div class="col-xs-4 bm-color col-md-4"><div class="col-xs-7 col-md-7 bm-text bm-color">销售自主活动&nbsp</div><div class="col-xs-4 bm-color bm-color-val bm-color-val-xs col-md-4"></div></div>
			</div>
			<div id='calendar'></div>
		</div>
		<div id="event-table">
			<div class="event-title">
				<span>
					<lable class="event-year" id="event-year"></lable>
					<label class="event-desc">MIP & ENERGY</label>
					<label class="event-month">--</label>
					<label class="event-desc">活动一览表</label>
					<label class="event-dist"></label>
				</span>
			</div>
			<table style="width:100%; margin-top:20px;color:white;border-collapse:collapse;">
					<tr style="text-align:left; color:white;font-size:1.3em">
						<th style="width:9%" class="event-td event-td-r">开始日期</th>
						<th style="width:9%" class="event-td event-td-r">结束日期</th>
						<th class="event-td event-td-r">活动名称</th>
						<th class="event-td event-td-r">地点</th>
						<th class="event-td event-td-r">活动类型</th>
						<th class="event-td event-td-r">术式</th>
						<th class="event-td" style="background-color:white;color:black;text-align:right;border: 0px solid white">负责人</th>
						<th class="event-td" style="background-color:white;color:black;text-align:center;padding-right:3px;border: 0px solid white">联系方式</th>
					</tr>
					<tbody id="event-body" style="font-size:1.2em">
				</tbody>
			</table>
		</div>
	</div>
</div>
<script src="dist/cpexcel.js"></script>
<script src="shim.js"></script>
<script src="jszip.js"></script>
<script src="xlsx.js"></script>
<script>
/*jshint browser:true */
/*global XLSX */
var X = XLSX;
var XW = {
	/* worker message */
	msg: 'xlsx',
	/* worker scripts */
	rABS: './xlsxworker2.js',
	norABS: './xlsxworker1.js',
	noxfer: './xlsxworker.js'
};

var rABS = typeof FileReader !== "undefined" && typeof FileReader.prototype !== "undefined" && typeof FileReader.prototype.readAsBinaryString !== "undefined";
if(!rABS) {
	document.getElementsByName("userabs")[0].disabled = true;
	document.getElementsByName("userabs")[0].checked = false;
}

var use_worker = typeof Worker !== 'undefined';
if(!use_worker) {
	document.getElementsByName("useworker")[0].disabled = true;
	document.getElementsByName("useworker")[0].checked = false;
}

var transferable = use_worker;
if(!transferable) {
	document.getElementsByName("xferable")[0].disabled = true;
	document.getElementsByName("xferable")[0].checked = false;
}

var wtf_mode = false;

function fixdata(data) {
	var o = "", l = 0, w = 10240;
	for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w,l*w+w)));
	o+=String.fromCharCode.apply(null, new Uint8Array(data.slice(l*w)));
	return o;
}

function ab2str(data) {
	var o = "", l = 0, w = 10240;
	for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint16Array(data.slice(l*w,l*w+w)));
	o+=String.fromCharCode.apply(null, new Uint16Array(data.slice(l*w)));
	return o;
}

function s2ab(s) {
	var b = new ArrayBuffer(s.length*2), v = new Uint16Array(b);
	for (var i=0; i != s.length; ++i) v[i] = s.charCodeAt(i);
	return [v, b];
}

function xw_noxfer(data, cb) {
	var worker = new Worker(XW.noxfer);
	worker.onmessage = function(e) {
		switch(e.data.t) {
			case 'ready': break;
			case 'e': console.error(e.data.d); break;
			case XW.msg: cb(JSON.parse(e.data.d)); break;
		}
	};
	var arr = rABS ? data : btoa(fixdata(data));
	worker.postMessage({d:arr,b:rABS});
}

function xw_xfer(data, cb) {
	var worker = new Worker(rABS ? XW.rABS : XW.norABS);
	worker.onmessage = function(e) {
		switch(e.data.t) {
			case 'ready': break;
			case 'e': console.error(e.data.d); break;
			default: xx=ab2str(e.data).replace(/\n/g,"\\n").replace(/\r/g,"\\r"); console.log("done"); cb(JSON.parse(xx)); break;
		}
	};
	if(rABS) {
		var val = s2ab(data);
		worker.postMessage(val[1], [val[1]]);
	} else {
		worker.postMessage(data, [data]);
	}
}

function xw(data, cb) {
	transferable = document.getElementsByName("xferable")[0].checked;
	if(transferable) xw_xfer(data, cb);
	else xw_noxfer(data, cb);
}

function get_radio_value( radioName ) {
	var radios = document.getElementsByName( radioName );
	for( var i = 0; i < radios.length; i++ ) {
		if( radios[i].checked || radios.length === 1 ) {
			return radios[i].value;
		}
	}
}

function to_json(workbook) {
	var result = {};
	workbook.SheetNames.forEach(function(sheetName) {
		var roa = X.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
		if(roa.length > 0){
			result[sheetName] = roa;
		}
	});
	return result;
}
function to_csv(workbook) {
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]);
		if(csv.length > 0){
			result.push("SHEET: " + sheetName);
			result.push("");
			result.push(csv);
		}
	});
	return result.join("\n");
}

function to_formulae(workbook) {
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var formulae = X.utils.get_formulae(workbook.Sheets[sheetName]);
		if(formulae.length > 0){
			result.push("SHEET: " + sheetName);
			result.push("");
			result.push(formulae.join("\n"));
		}
	});
	return result.join("\n");
}

function to_html(workbook) {
	document.getElementById('htmlout').innerHTML = "";
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var htmlstr = X.write(workbook, {sheet:sheetName, type:'binary', bookType:'html'});
		document.getElementById('htmlout').innerHTML += htmlstr;
	});
}

var tarea = document.getElementById('b64data');
function b64it() {
	if(typeof console !== 'undefined') console.log("onload", new Date());
	var wb = X.read(tarea.value, {type: 'base64',WTF:wtf_mode});
	process_wb(wb);
}

var global_wb;
function process_wb(wb) {
	global_wb = wb;
	var output = "";
	switch(get_radio_value("format")) {
		case "json":
			output = to_json(wb);
			break;
		case "form":
			output = to_formulae(wb);
			break;
		case "html": return to_html(wb);
		default:
			output = to_csv(wb);
	}
	processData(output);
	// alert(output);
	//  if(out.innerText === undefined) out.textContent = output;
	//  else out.innerText = output;
	if(typeof console !== 'undefined') console.log("output", new Date());
}
var colors={'区域市场部':'#F9C090','销售自主活动':'#B3A2C7','中央市场部':'#FEDD28','PE':'#C3D69B'};
sheetData = null;
function processData(msg) {
	if (null == msg) {
		alert("处理失败或数据格式不正确!")
	}
	var data = msg.Sheet1;
	if (null == data) {
		alert("请确定表格内存在Sheet1的表格");
	}
	var events = [];
	var disName= "--";
	sheetData = new Array();
	//var tmpData = data.slice(0);
	$.each(data, function(index, item){
		 if (undefined != item.活动名称 && null!=item.活动名称 && $.trim(item.活动名称)!='') {
		 		sheetData.push(item);
		 }
	});

	console.log(sheetData.length);
	var typeIndex = {"中央市场部":0, "区域市场部":1,"PE":2,"销售自主活动":3};
	var eventTypeSort = function(o, p){
		a = $.trim(o["活动类型"]);
		b = $.trim(p["活动类型"]);
		if(null == a){
			a=5;
		}else {
			a = typeIndex[a];
		}
		if (null == b) {
			b = 5;
		}else{
			b = typeIndex[b];
		}
		if (a === b) {
			return 0;
		}
		if (typeof a === typeof b) {
			return a < b ? -1 : 1;
		}
		return typeof a < typeof b ? -1 : 1;
	}
	var sheetSort = function(name){
		return function(o, p){
			var result1 = eventTypeSort(o, p);
			if (0 != result1) {
				return result1;
			}
			var a, b;
		   if (typeof o === "object" && typeof p === "object" && o && p) {

		     a = o[name];
		     b = p[name];
				 try{
					 var aDateEles = a.split("/");
					 if (null == aDateEles || aDateEles.length != 3) {
					 	 a = 10000000000000;
					 }else{
				 		a = new Date($.trim(a.replace("年","/").replace("月","/").replace("日", ""))).getTime();
					}
				 }catch(e){
				 	a = 10000000000000;
				 }
				 try{
					 var bDateEles = b.split("/");
					 if (null == bDateEles || bDateEles.length != 3) {
					 	 bug= 10000000000000;
					 }else{
				 	b = new Date($.trim(b.replace("年","/").replace("月","/").replace("日", ""))).getTime();
					}
				 }catch(e){
				 	b = 10000000000000;
				 }

		     if (a === b) {
		       return 0;
		     }
		     if (typeof a === typeof b) {
		       return a < b ? -1 : 1;
		     }
		     return typeof a < typeof b ? -1 : 1;
		   }
		   else {
		     throw ("error");
		   }
		}
	}
	sheetData.sort(sheetSort("活动开始日期"));
	var globalDis = false;
	$.each(data, function(index, item){
		if (undefined != item.举办地点 && null != item.举办地点 &&
			undefined != item.术式 && null != item.术式 &&
			undefined != item.活动开始日期 && null != item.活动开始日期 && undefined != item.活动结束日期 && null != item.活动结束日期 ) {
			var event = {"title":item.举办地点+"，"+item.术式,"start":new Date($.trim(item.活动开始日期.replace("年","/").replace("月","/").replace("日", ""))),
					"end":new Date($.trim(item.活动结束日期.replace("年","/").replace("月","/").replace("日", " 23:59:59"))),"color":colors[$.trim(item.活动类型)]};
			if ('--'!=disName && disName != item.区域) {
				globalDis = true;
			}else{
				disName = item.区域;
			}
			events.push(event);
					console.log(item.活动名称+$.trim(item.活动开始日期.replace("年","/").replace("月","/").replace("日", "")));
					console.log($.trim(item.活动结束日期.replace("年","/").replace("月","/").replace("日", "")));
		}
	})
	if (globalDis) {
		disName = "全国";
	}
	$("#dis-name").html(disName);
	$(".event-dist").html("("+disName+")");
	// alert(events);
	// $.each(msg, function(i, item){
	// 	alert(i);
	// 	alert(item);
	// });
	$('#calendar').fullCalendar('removeEvents');
	$('#calendar').fullCalendar('addEventSource', events);
	$("#event-body").html('');
	$(".fc-scroller").css("height", "100%");
	$.each(sheetData, function(index, item){
		var startDate;
		try{
			startDate = $.trim(item["活动开始日期"]);
			var startDateEles = startDate.split("/");
			if (null == startDateEles || startDateEles.length != 3) {
					startDate="待定";
			}else{
				startDate = startDateEles[1]+"月"+startDateEles[2]+"日";
			}
		}catch(e){
			startDate="待定";
		}
		var endDate;
		try{
			endDate = $.trim(item["活动结束日期"]);
			var endDateEles = endDate.split("/");
			if(null == endDateEles || endDateEles.length != 3 ){
				endDate="待定";
			}else {
				endDate = endDateEles[1]+"月"+endDateEles[2]+"日";
			}
		}catch(e){
			endDate="待定";
		}
		var eventName = item["活动名称"];
		var place = item["举办地点"];
		var type= $.trim(item["活动类型"]);
		var sh = item["术式"];
		var master = item["负责人"];
		var tel = item["负责人手机号"];
		var tr = '<tr style="text-align:left; color:black;">'
			+'<td class="event-td" style="background-color:'+colors[type]+';border: 1px solid '+colors[type]+';">'+startDate+'</td>'
			+'<td class="event-td" style="background-color:'+colors[type]+';border: 1px solid '+colors[type]+';">'+endDate+'</td>'
			+'<td class="event-td" style="background-color:'+colors[type]+';border: 1px solid '+colors[type]+';">'+eventName+'</td>'
			+'<td class="event-td" style="background-color:'+colors[type]+';border: 1px solid '+colors[type]+';">'+place+'</td>'
			+'<td class="event-td" style="background-color:'+colors[type]+';border: 1px solid '+colors[type]+';">'+type+'</td>'
			+'<td class="event-td" style="background-color:'+colors[type]+';border: 1px solid '+colors[type]+';">'+sh+'</td>'
			+'<td class="event-td" style="background-color:white;text-align:right">'+(null != master?master:'--')+'</td>'
			+'<td class="event-td" style="background-color:white;text-align:center;padding-right:3px">'+(null != tel?tel.replace("-",""):'--')+'</td>'
			+'</tr>';
			$("#event-body").append(tr);
	})
	console.log(JSON.stringify(msg, 2, 2));

}
function setfmt() {if(global_wb) process_wb(global_wb); }

var drop = document.getElementById('drop');
function handleDrop(e) {
	e.stopPropagation();
	e.preventDefault();
	rABS = document.getElementsByName("userabs")[0].checked;
	use_worker = document.getElementsByName("useworker")[0].checked;
	var files = e.dataTransfer.files;
	var f = files[0];
	{
		var reader = new FileReader();
		var name = f.name;
		reader.onload = function(e) {
			if(typeof console !== 'undefined') console.log("onload", new Date(), rABS, use_worker);
			var data = e.target.result;
			if(use_worker) {
				xw(data, process_wb);
			} else {
				var wb;
				if(rABS) {
					wb = X.read(data, {type: 'binary'});
				} else {
					var arr = fixdata(data);
					wb = X.read(btoa(arr), {type: 'base64'});
				}
				process_wb(wb);
			}
		};
		if(rABS) reader.readAsBinaryString(f);
		else reader.readAsArrayBuffer(f);
	}
}

function handleDragover(e) {
	e.stopPropagation();
	e.preventDefault();
	e.dataTransfer.dropEffect = 'copy';
}

if(drop.addEventListener) {
	drop.addEventListener('dragenter', handleDragover, false);
	drop.addEventListener('dragover', handleDragover, false);
	drop.addEventListener('drop', handleDrop, false);
}
function saveHtml2Image(objId, scale) {
            document.body.scrollTop = 0;
            var obj = $("#" + objId);
            var width = obj.width();
            var height = obj.height();
            html2canvas(obj, {
                width: width,
                height: height,
                background: "rgba(255,255,255,1)",
                onrendered: function (canvas) {
                    var dataUrl = Canvas2Image.saveAsPNG(canvas, parseInt(width * scale), parseInt(height * scale));
                    // var totalSize = dataUrl.length / 1024 / 1024;
                    // if (totalSize > 1.3) {
                    //     dataUrl = null;
                    //     scale = scale - 0.1;
                    //     saveHtml2Image(objId, scale);
                    // }
                    // else {
                    //     $('#downloadImage').attr('href', dataUrl);
                    //     $('#downloadImage').attr('download', 'test.jpg');
                    //     $('#downloadImage')[0].click();
                    // }
                }
            });
        }

 $("#toImageBt").click(function(){
	 $(".fc-header-toolbar").hide();
	 $("html").css("overflow-y","hidden");
	 	saveHtml2Image("data-panel", 1);
		$(".fc-header-toolbar").show();
		$("html").css("overflow-y","visible");
 })
var xlf = document.getElementById('xlf');
function handleFile(e) {
	rABS = document.getElementsByName("userabs")[0].checked;
	use_worker = document.getElementsByName("useworker")[0].checked;
	var files = e.target.files;
	var f = files[0];
	{
		var reader = new FileReader();
		var name = f.name;
		reader.onload = function(e) {
			if(typeof console !== 'undefined') console.log("onload", new Date(), rABS, use_worker);
			var data = e.target.result;
			if(use_worker) {
				xw(data, process_wb);
			} else {
				var wb;
				if(rABS) {
					wb = X.read(data, {type: 'binary'});
				} else {
					var arr = fixdata(data);
					wb = X.read(btoa(arr), {type: 'base64'});
				}
				process_wb(wb);
			}
		};
		if(rABS) reader.readAsBinaryString(f);
		else reader.readAsArrayBuffer(f);
	}
}

//if(xlf.addEventListener) xlf.addEventListener('change', handleFile, false);
</script>
<script>
	$(function(){
		init();
		var circle_month = $("#top-month").css("font-size").replace("px","");
		var dis_name = $("#dis-name").css("font-size").replace("px","");
		var event_year=$("#event-year").css("font-size").replace("px","");
		var event_desc = $(".event-desc").css("font-size").replace("px","");
		var event_month=$(".event-month").css("font-size").replace("px","");
		var event_dist=$(".event-dist").css("font-size").replace("px","");

		function init(){
			$("#circle-month").css("line-height",$("#circle-month").css("height"));
			$("#top-month").html(en_month_kv[$(".fc-center").find("h2").html().split('-')[1]]);

			$("#event-year").html(new Date().getFullYear());
			$(".event-month").html(en_ch_month_kv[$(".fc-center").find("h2").html().split('-')[1]]);
			var tH1 = $("#banner-sec").height();
			//var tH2 = $(".bm-color").height();
			$(".event-title").css("height",(tH1)+"px").css("line-height",(tH1)+"px");
		}
		$(".fc-button-group").find("button").click(function(){
			$("#top-month").html(en_month_kv[$(".fc-center").find("h2").html().split('-')[1]]);
			$(".event-month").html(en_ch_month_kv[$(".fc-center").find("h2").html().split('-')[1]]);
			$("#event-year").html($(".fc-center").find("h2").html().split('-')[0]);
		});
		$(".fc-today-button").click(function(){
			$("#top-month").html(en_month_kv[$(".fc-center").find("h2").html()]);
			$(".event-month").html(en_ch_month_kv[$(".fc-center").find("h2").html().split('-')[1]]);
			$("#event-year").html($(".fc-center").find("h2").html().split('-')[0]);
		});
		$("#body-scale").change(function(){
			$("body").css("width", $(this).val()+"%");
			var per = $(this).val();
			per = per/100.0;
			$("#top-month").css("font-size", circle_month * per);
			$("#dis-name").css("font-size", dis_name * per);
			$("#event-year").css("font-size", event_year * per);
			$(".event-desc").css("font-size", event_desc * per);
			$(".event-month").css("font-size", event_month * per);
			$(".event-dist").css("font-size", event_dist * per);
			init();
		})
		$("#body-select").change(function(){
			$("body").css("width",$(this).val());
			var per = $(this).val().replace("%", "");
			per = per/100.0;
			$("#top-month").css("font-size", circle_month * per);
			$("#dis-name").css("font-size", dis_name * per);
			$("#event-year").css("font-size", event_year * per);
			$(".event-desc").css("font-size", event_desc * per);
			$(".event-month").css("font-size", event_month * per);
			$(".event-dist").css("font-size", event_dist * per);
			init();
		})
		//$("#disc-month").hide();
	})
</script>
<!-- <script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-36810333-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script> -->
</body>
</html>
